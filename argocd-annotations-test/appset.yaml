apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: test-appset
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - env: dev
  template:
    metadata:
      name: test-app-{{.env}}
    spec:
      project: default
      sources:
        - repoURL: https://github.com/himeshpanc/rocket-apps.git
          path: "argocd-annotations-test/overlays/{{.env}}"
          targetRevision: main
          kustomize:
            commonAnnotations:
              TEST_ANNOTATION: "kustomize-annotation"
        - repoURL: https://github.com/himeshpanc/rocket-apps.git
          path: "argocd-annotations-test/overlays/{{.env}}"
          targetRevision: main
          helm:
            valueFiles:
              - values.yaml
            values: |
              backend:
                replicaCount: 1
                image:
                  repository: himeshp/lunar-app
                  tag: v2
                  pullPolicy: Always
                service:
                  type: NodePort
                  port: 3000
                  targetPort: 3000
                  nodePort: 30000
                resources:
                  limits:
                    cpu: 300m
                    memory: 256Mi
                  requests:
                    cpu: 100m
                    memory: 128Mi
      destination:
        server: https://kubernetes.default.svc
        namespace: test-ns-{{.env}}